---
description: YAML template conventions for Kubernetes resource templates
globs: templates/*.yaml
alwaysApply: false
---

# YAML Template Conventions

## Placeholder Syntax

Templates use `{VARIABLE_NAME}` placeholders processed by `sed` in `process_template()`.

### Available placeholders

`{vm-ns}`, `{vm-id}`, `{VM_BASENAME}`, `{BATCH_ID}`, `{DV_URL}`, `{DATASOURCE}`, `{DATASOURCE_NS}`, `{BASE_PVC_NAME}`, `{STORAGE_SIZE}`, `{STORAGE_CLASS}`, `{ACCESS_MODE}`, `{SNAPSHOT_CLASS}`, `{VM_CPU_CORES}`, `{VM_MEMORY}`, `{RUN_STRATEGY}`

### Indented token placeholders

`{CLOUDINIT_DISK}`, `{CLOUDINIT_VOLUME}`, `{RESOURCES}` are processed by `indent_token()`. These must appear **alone on a line** with leading spaces that define the indentation level:

```yaml
      devices:
        disks:
        - disk:
            bus: virtio
          name: vda
        {CLOUDINIT_DISK}
```

## Required Labels

All resources must include both labels:

```yaml
labels:
  batch-id: "{BATCH_ID}"
  vm-basename: "{VM_BASENAME}"
```

## Style

- 2-space YAML indentation (enforced by yamllint)
- No `---` document-start marker (disabled in `.yamllint`)
- Use `volumeMode: Block` for storage specs
- Quote label values that could be interpreted as non-strings: `batch-id: "{BATCH_ID}"`
