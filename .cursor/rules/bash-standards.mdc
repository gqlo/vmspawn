---
description: Bash coding conventions for the vmspawn script and helper scripts
globs: vmspawn,helpers/*
alwaysApply: false
---

# Bash Coding Standards

## Script Header

Every script must start with `#!/bin/bash` and `set -eu` (exit on error, error on unset variables).

## Error Handling

Use `fatal()` for error exits -- never bare `echo` + `exit 1`:

```bash
# BAD
echo "Error: something failed"
exit 1

# GOOD
fatal "Error: something failed"
```

## Variable Naming

- **Globals/config**: `UPPER_SNAKE_CASE` (e.g. `STORAGE_CLASS`, `NUM_VMS`)
- **Locals**: `lower_snake_case` (e.g. `namespace`, `vm_count`)
- Declare locals with `local` or `local -i` for integers

## Syntax Conventions

- Use `(( ))` for arithmetic, `[[ ]]` for string/file tests -- never `[ ]`
- Use **tab indentation** (not spaces) for shell code
- Use `$(command)` for command substitution, never backticks

## Output

- Use `log_message` for user-facing status output, not raw `echo`
- `echo` is acceptable only inside `fatal()` and `help()`

## Functions

- Use `function_name() {` style (no `function` keyword)
- The one exception is `function process_template()` which uses the keyword for historical reasons

## Option Parsing

- Short options use `getopts`
- Long options are parsed via the `process_option()` helper inside the `getopts` loop
- New options must be added to both the parser and the `help()` text
