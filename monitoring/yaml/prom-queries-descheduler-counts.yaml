# prom-queries-descheduler-counts.yaml - Count of nodes per step where metric >= 10%
# yamllint disable rule:line-length
#
# All queries use descheduler recording rules (requires descheduler PrometheusRule in cluster).
# Cross-reference: monitoring/desched-rules.yaml
#
# Usage:
#   monitoring/prom-query -f monitoring/prom-queries-descheduler-counts.yaml -l
#   monitoring/prom-query -f monitoring/prom-queries-descheduler-counts.yaml count-cpu-util-pd

# ~48h range, 1m step. Each query returns count of nodes with value >= 0.1 at each step.
defaults:
  start: "2026-02-19 21:00:00"
  end: "2026-02-21 21:00:00"
  step: 1m

count-cpu-util-pd:
  description: "Count of nodes with CPU util positive deviation >= 10% (per step over 48h)"
  query: count(descheduler:nodeutilization:cpu:avg1m:positivedeviation >= 0.1)

count-cpu-pressure-pd:
  description: "Count of nodes with CPU pressure positive deviation >= 10% (per step over 48h)"
  query: count(descheduler:nodepressure:cpu:avg1m:positivedeviation >= 0.1)

count-memory-util-pd:
  description: "Count of nodes with memory util positive deviation >= 10% (per step over 48h)"
  query: count(descheduler:nodeutilization:memory:avg1m:positivedeviation >= 0.1)

count-memory-pressure-pd:
  description: "Count of nodes with memory pressure positive deviation >= 10% (per step over 48h)"
  query: count(descheduler:nodepressure:memory:avg1m:positivedeviation >= 0.1)

count-ideal-point-distance:
  description: "Count of nodes with ideal-point distance >= 10% (per step over 48h)"
  query: count(descheduler:node:ideal_point_positive_distance:avg1m >= 0.1)

count-linear-amplified-distance:
  description: "Count of nodes with linear amplified (k3) distance >= 10% (per step over 48h)"
  query: count(descheduler:node:linear_amplified_ideal_point_positive_distance:k3:avg1m >= 0.1)
